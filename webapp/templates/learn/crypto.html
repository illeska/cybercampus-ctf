{% extends "base.html" %}
{% block title %}Cours : Rainbow Tables - CyberCampus CTF{% endblock %}

{% block content %}
<section class="page-wrapper course-page">
  
  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <a href="{{ url_for('learn') }}">ğŸ“š BibliothÃ¨que</a>
    <span class="separator">/</span>
    <span class="current">Cryptographie</span>
  </div>

  <!-- En-tÃªte du cours -->
  <div class="course-header">
    <div class="course-header-icon">ğŸŒˆ</div>
    <div class="course-header-content">
      <h1>Cryptographie</h1>
      <p class="course-subtitle">Comprendre les attaques sur les mots de passe hashÃ©s</p>
      <div class="course-badges">
        <span class="badge-high">Ã‰levÃ©</span>
        <span class="badge-time">ğŸ“– 20 min</span>
        <span class="badge-level">âš¡ IntermÃ©diaire</span>
      </div>
    </div>
  </div>

  <!-- Contenu du cours -->
  <div class="course-content">

    <!-- Section 1 -->
    <div class="course-section">
      <h2>ğŸ” C'est quoi un hash ?</h2>
      <p>
        Un <strong>hash</strong> (ou empreinte cryptographique) est le rÃ©sultat d'une fonction mathÃ©matique qui transforme 
        n'importe quelle donnÃ©e en une chaÃ®ne de caractÃ¨res de taille fixe. C'est une <strong>fonction Ã  sens unique</strong> : 
        facile dans un sens, quasi impossible dans l'autre.
      </p>
      
      <div class="code-block">
        <div class="code-header">
          <span class="code-status">ğŸ“Œ Exemple MD5</span>
          <span class="code-lang">Python</span>
        </div>
        <pre><code>import hashlib

# Hasher un mot de passe
password = "password"
hash_md5 = hashlib.md5(password.encode()).hexdigest()

print(hash_md5)
# RÃ©sultat : 5f4dcc3b5aa765d61d8327deb882cf99</code></pre>
      </div>

      <div class="info-box">
        <div class="info-icon">ğŸ’¡</div>
        <div class="info-content">
          <strong>PropriÃ©tÃ© importante :</strong>
          <p>
            Le mÃªme mot de passe produit TOUJOURS le mÃªme hash. C'est ce qui rend MD5 vulnÃ©rable aux rainbow tables !
          </p>
        </div>
      </div>

      <h3>CaractÃ©ristiques d'une fonction de hash</h3>
      <ul>
        <li><strong>DÃ©terministe</strong> : MÃªme entrÃ©e = mÃªme hash</li>
        <li><strong>Rapide Ã  calculer</strong> : Calcul quasi instantanÃ©</li>
        <li><strong>IrrÃ©versible</strong> : Impossible de retrouver l'entrÃ©e depuis le hash (en thÃ©orie)</li>
        <li><strong>Effet avalanche</strong> : Un petit changement dans l'entrÃ©e change complÃ¨tement le hash</li>
        <li><strong>RÃ©sistance aux collisions</strong> : Deux entrÃ©es diffÃ©rentes ne doivent pas donner le mÃªme hash</li>
      </ul>

      <div class="transformation-box">
        <div class="transform-before">
          <strong>EntrÃ©e :</strong>
          <code>password</code>
        </div>
        <div class="transform-arrow">â†’</div>
        <div class="transform-after">
          <strong>Hash MD5 :</strong>
          <code>5f4dcc3b5aa765d61d8327deb882cf99</code>
        </div>
      </div>

      <div class="transformation-box">
        <div class="transform-before">
          <strong>EntrÃ©e :</strong>
          <code>Password</code> (P majuscule)
        </div>
        <div class="transform-arrow">â†’</div>
        <div class="transform-after">
          <strong>Hash MD5 :</strong>
          <code>dc647eb65e6711e155375218212b3964</code>
        </div>
      </div>

      <p style="margin-top: 15px;">
        Comme vous pouvez le voir, un simple changement de casse modifie complÃ¨tement le hash !
      </p>
    </div>

    <!-- Section 2 -->
    <div class="course-section">
      <h2>ğŸŒˆ Qu'est-ce qu'une Rainbow Table ?</h2>
      <p>
        Une <strong>rainbow table</strong> est une immense base de donnÃ©es prÃ©-calculÃ©e qui contient des millions 
        (voire des milliards) de mots de passe courants et leurs hash correspondants.
      </p>

      <h3>Le principe</h3>
      <div class="example-box">
        <strong>Base de donnÃ©es prÃ©-calculÃ©e :</strong>
        <code>password     â†’ 5f4dcc3b5aa765d61d8327deb882cf99
123456       â†’ e10adc3949ba59abbe56e057f20f883e
qwerty       â†’ d8578edf8458ce06fbc5bb76a58c5ca4
admin        â†’ 21232f297a57a5a743894a0e4a801fc3
letmein      â†’ 0d107d09f5bbe40cade3de5c71e9e9b7</code>
      </div>

      <h3>Comment Ã§a marche ?</h3>
      <div class="attack-types">
        <div class="attack-type-card">
          <h4>1ï¸âƒ£ PrÃ©-calcul</h4>
          <p>On gÃ©nÃ¨re des millions de hash Ã  l'avance et on les stocke dans une base de donnÃ©es.</p>
        </div>
        <div class="attack-type-card">
          <h4>2ï¸âƒ£ Recherche</h4>
          <p>Quand on rÃ©cupÃ¨re un hash, on le cherche simplement dans la table pour retrouver le mot de passe.</p>
        </div>
        <div class="attack-type-card">
          <h4>3ï¸âƒ£ SuccÃ¨s instantanÃ©</h4>
          <p>Si le hash est dans la table, on obtient le mot de passe en quelques millisecondes !</p>
        </div>
      </div>

      <div class="explanation-box">
        <h4>Taille des rainbow tables</h4>
        <p>Les rainbow tables modernes contiennent :</p>
        <ul>
          <li>ğŸ“Š Plusieurs <strong>milliards</strong> de hash prÃ©-calculÃ©s</li>
          <li>ğŸ’¾ Plusieurs <strong>tÃ©raoctets</strong> de donnÃ©es</li>
          <li>âš¡ RÃ©sultats en <strong>quelques secondes</strong> au lieu de plusieurs jours</li>
        </ul>
      </div>
    </div>

    <!-- Section 3 -->
    <div class="course-section">
      <h2>ğŸ’¥ Pourquoi MD5 est dangereux ?</h2>
      <p>
        MD5 (Message Digest 5) Ã©tait autrefois considÃ©rÃ© comme sÃ»r, mais il prÃ©sente aujourd'hui 
        de <strong>graves failles de sÃ©curitÃ©</strong> :
      </p>

      <div class="attack-types">
        <div class="attack-type-card">
          <h4>âš¡ Trop rapide</h4>
          <p>
            Une carte graphique moderne peut calculer <strong>10 milliards de hash MD5 par seconde</strong>. 
            Un mot de passe de 6 caractÃ¨res peut Ãªtre crackÃ© en quelques secondes.
          </p>
        </div>

        <div class="attack-type-card">
          <h4>ğŸ”„ Collisions</h4>
          <p>
            Des chercheurs ont dÃ©montrÃ© qu'il est possible de trouver deux entrÃ©es diffÃ©rentes 
            qui produisent le mÃªme hash MD5.
          </p>
        </div>

        <div class="attack-type-card">
          <h4>ğŸŒˆ Rainbow Tables</h4>
          <p>
            Des bases de donnÃ©es publiques contiennent des milliards de hash MD5 prÃ©-calculÃ©s, 
            rendant le cracking quasi instantanÃ©.
          </p>
        </div>
      </div>

      <div class="info-box" style="margin-top: 25px;">
        <div class="info-icon">â±ï¸</div>
        <div class="info-content">
          <strong>Temps de cracking selon la longueur :</strong>
          <code>â€¢ 4 caractÃ¨res (a-z, 0-9) â†’ InstantanÃ©
â€¢ 6 caractÃ¨res (a-z, 0-9) â†’ Quelques secondes
â€¢ 8 caractÃ¨res (a-z, A-Z, 0-9) â†’ Quelques heures
â€¢ 10 caractÃ¨res (a-z, A-Z, 0-9, symboles) â†’ Plusieurs jours
â€¢ 12 caractÃ¨res+ avec symboles â†’ AnnÃ©es (mais toujours vulnÃ©rable)</code>
        </div>
      </div>
    </div>

    <!-- Section 4 -->
    <div class="course-section">
      <h2>ğŸ› ï¸ Outils de hash cracking</h2>
      <p>Voici les principaux outils utilisÃ©s par les professionnels de la sÃ©curitÃ© :</p>

      <div class="protection-method">
        <div class="method-number">1</div>
        <div class="method-content">
          <h3>CrackStation (En ligne)</h3>
          <p>
            <strong>Site :</strong> <a href="https://crackstation.net" target="_blank" style="color: #00f5c0;">crackstation.net</a>
          </p>
          <p>
            Service gratuit avec une rainbow table massive. IdÃ©al pour les dÃ©butants. 
            Supporte MD5, SHA1, SHA256, et bien d'autres.
          </p>
          <div class="success-box">
            <strong>Avantages :</strong> Gratuit, rapide, aucune installation requise
          </div>
        </div>
      </div>

      <div class="protection-method">
        <div class="method-number">2</div>
        <div class="method-content">
          <h3>Hashcat (Professionnel)</h3>
          <p>L'outil de rÃ©fÃ©rence pour le hash cracking professionnel.</p>
          
          <div class="code-block">
            <div class="code-header">
              <span class="code-status">ğŸ”§ Installation & Usage</span>
              <span class="code-lang">Bash</span>
            </div>
            <pre><code># Installation
sudo apt install hashcat

# CrÃ©er un fichier avec les hash
echo "5f4dcc3b5aa765d61d8327deb882cf99" > hash.txt

# Attaque par dictionnaire (mode 0 = MD5)
hashcat -m 0 -a 0 hash.txt rockyou.txt

# Attaque avec rÃ¨gles (variations)
hashcat -m 0 -a 0 hash.txt rockyou.txt -r rules/best64.rule

# Afficher les rÃ©sultats
hashcat -m 0 hash.txt --show</code></pre>
          </div>

          <div class="success-box">
            <strong>Avantages :</strong> TrÃ¨s rapide, supporte GPU, rÃ¨gles avancÃ©es, tous les algorithmes
          </div>
        </div>
      </div>

      <div class="protection-method">
        <div class="method-number">3</div>
        <div class="method-content">
          <h3>John the Ripper</h3>
          <p>Un autre outil classique, plus ancien que Hashcat mais toujours trÃ¨s utilisÃ©.</p>
          
          <div class="code-block">
            <div class="code-header">
              <span class="code-status">ğŸ”§ Usage basique</span>
              <span class="code-lang">Bash</span>
            </div>
            <pre><code># Installation
sudo apt install john

# Cracker un hash
john --format=Raw-MD5 --wordlist=rockyou.txt hashes.txt

# Voir les rÃ©sultats
john --show --format=Raw-MD5 hashes.txt</code></pre>
          </div>
        </div>
      </div>
    </div>

    <!-- Section 5 -->
    <div class="course-section">
      <h2>ğŸ›¡ï¸ Comment se protÃ©ger ?</h2>
      <p>
        Les rainbow tables exploitent une faiblesse fondamentale : <strong>le mÃªme mot de passe 
        donne toujours le mÃªme hash</strong>. Voici comment se protÃ©ger efficacement :
      </p>

      <div class="protection-method">
        <div class="method-number">1</div>
        <div class="method-content">
          <h3>Utiliser un algorithme moderne (bcrypt, Argon2, scrypt)</h3>
          <p>
            Ces algorithmes sont <strong>intentionnellement lents</strong> et incluent automatiquement 
            un sel unique pour chaque mot de passe.
          </p>
          
          <div class="code-block safe">
            <div class="code-header">
              <span class="code-status">âœ… Code sÃ©curisÃ© avec bcrypt</span>
              <span class="code-lang">Python</span>
            </div>
            <pre><code>import bcrypt

# Hasher un mot de passe (avec sel automatique)
password = "password"
salt = bcrypt.gensalt(rounds=12)  # 2^12 itÃ©rations
hashed = bcrypt.hashpw(password.encode(), salt)

print(hashed)
# RÃ©sultat : $2b$12$N9qo8uLOickgx2ZMRZoMye...
# Chaque hash est UNIQUE mÃªme pour le mÃªme mot de passe !</code></pre>
          </div>

          <div class="transformation-box">
            <div class="transform-before">
              <strong>Avec MD5 (dangereux) :</strong>
              <code>password â†’ 5f4dcc3b5aa...
password â†’ 5f4dcc3b5aa... (identique !)</code>
            </div>
            <div class="transform-arrow">â†’</div>
            <div class="transform-after">
              <strong>Avec bcrypt (sÃ©curisÃ©) :</strong>
              <code>password â†’ $2b$12$N9qo8...
password â†’ $2b$12$X7pq9... (diffÃ©rent !)</code>
            </div>
          </div>
        </div>
      </div>

      <div class="protection-method">
        <div class="method-number">2</div>
        <div class="method-content">
          <h3>Ajouter un sel unique (Salt)</h3>
          <p>
            Un <strong>sel</strong> est une valeur alÃ©atoire ajoutÃ©e au mot de passe avant le hashage. 
            Chaque utilisateur a un sel diffÃ©rent.
          </p>
          
          <div class="code-block safe">
            <div class="code-header">
              <span class="code-status">âœ… Exemple avec sel</span>
              <span class="code-lang">Python</span>
            </div>
            <pre><code>import hashlib
import os

# GÃ©nÃ©rer un sel alÃ©atoire unique
salt = os.urandom(32)  # 32 bytes alÃ©atoires

# Combiner mot de passe + sel
password = "password"
salted = password.encode() + salt

# Hasher le tout
hash_with_salt = hashlib.sha256(salted).hexdigest()

# Stocker : hash + sel (le sel n'est pas secret)
# En base : hash_with_salt, salt.hex()</code></pre>
          </div>

          <div class="explanation-box">
            <h4>Pourquoi le sel fonctionne ?</h4>
            <p>
              MÃªme si deux utilisateurs ont le mÃªme mot de passe, leurs sels diffÃ©rents produiront 
              des hash diffÃ©rents. Les rainbow tables deviennent inutiles car chaque hash est unique !
            </p>
          </div>
        </div>
      </div>

      <div class="protection-method">
        <div class="method-number">3</div>
        <div class="method-content">
          <h3>Ajouter un pepper (Sel secret)</h3>
          <p>
            Un <strong>pepper</strong> est comme un sel, mais il est <strong>identique pour tous les utilisateurs</strong> 
            et stockÃ© sÃ©parÃ©ment de la base de donnÃ©es (dans le code ou une variable d'environnement).
          </p>
          
          <div class="code-block safe">
            <div class="code-header">
              <span class="code-status">âœ… Exemple avec pepper</span>
              <span class="code-lang">Python</span>
            </div>
            <pre><code>import hashlib
import os

# Pepper stockÃ© dans une variable d'environnement
PEPPER = os.getenv('PASSWORD_PEPPER', 'super_secret_pepper_2025')

# Sel unique par utilisateur
salt = os.urandom(32)
password = "password"

# Combiner : mot de passe + sel + pepper
combined = password.encode() + salt + PEPPER.encode()
hash_final = hashlib.sha256(combined).hexdigest()

# MÃªme si la BDD est compromise, sans le pepper, impossible de craquer !</code></pre>
          </div>

          <div class="success-box">
            <strong>Avantage :</strong> Si votre base de donnÃ©es est volÃ©e, l'attaquant n'a pas le pepper 
            et ne peut donc pas craquer les hash, mÃªme avec une rainbow table !
          </div>
        </div>
      </div>

      <div class="protection-method">
        <div class="method-number">4</div>
        <div class="method-content">
          <h3>Imposer des mots de passe robustes</h3>
          <ul>
            <li><strong>Minimum 12 caractÃ¨res</strong> (idÃ©alement 16+)</li>
            <li><strong>MÃ©lange obligatoire :</strong> majuscules, minuscules, chiffres, symboles</li>
            <li><strong>Interdire les mots de passe communs</strong> (liste noire)</li>
            <li><strong>VÃ©rifier contre les bases de fuites</strong> (Have I Been Pwned API)</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Section 6 -->
    <div class="course-section">
      <h2>âš–ï¸ Comparaison des algorithmes</h2>
      
      <div class="code-snippet" style="background: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 10px;">
        <table style="width: 100%; color: #cbd5e1;">
          <thead>
            <tr style="border-bottom: 2px solid rgba(0, 245, 192, 0.3);">
              <th style="text-align: left; padding: 10px; color: #00f5c0;">Algorithme</th>
              <th style="text-align: center; padding: 10px; color: #00f5c0;">Statut</th>
              <th style="text-align: center; padding: 10px; color: #00f5c0;">Vitesse</th>
              <th style="text-align: center; padding: 10px; color: #00f5c0;">SÃ©curitÃ©</th>
            </tr>
          </thead>
          <tbody>
            <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
              <td style="padding: 10px;"><strong>MD5</strong></td>
              <td style="text-align: center; padding: 10px; color: #ef4444;">âŒ OBSOLÃˆTE</td>
              <td style="text-align: center; padding: 10px;">10 Mrd/s</td>
              <td style="text-align: center; padding: 10px; color: #ef4444;">TrÃ¨s faible</td>
            </tr>
            <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
              <td style="padding: 10px;"><strong>SHA-1</strong></td>
              <td style="text-align: center; padding: 10px; color: #ef4444;">âŒ OBSOLÃˆTE</td>
              <td style="text-align: center; padding: 10px;">5 Mrd/s</td>
              <td style="text-align: center; padding: 10px; color: #ef4444;">TrÃ¨s faible</td>
            </tr>
            <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
              <td style="padding: 10px;"><strong>SHA-256</strong></td>
              <td style="text-align: center; padding: 10px; color: #f59e0b;">âš ï¸ DÃ©conseillÃ©</td>
              <td style="text-align: center; padding: 10px;">2 Mrd/s</td>
              <td style="text-align: center; padding: 10px; color: #f59e0b;">Faible (sans sel)</td>
            </tr>
            <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
              <td style="padding: 10px;"><strong>bcrypt</strong></td>
              <td style="text-align: center; padding: 10px; color: #10b981;">âœ… RECOMMANDÃ‰</td>
              <td style="text-align: center; padding: 10px;">~50/s</td>
              <td style="text-align: center; padding: 10px; color: #10b981;">Excellente</td>
            </tr>
            <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.05);">
              <td style="padding: 10px;"><strong>Argon2</strong></td>
              <td style="text-align: center; padding: 10px; color: #10b981;">âœ… RECOMMANDÃ‰</td>
              <td style="text-align: center; padding: 10px;">~10/s</td>
              <td style="text-align: center; padding: 10px; color: #10b981;">Excellente</td>
            </tr>
            <tr>
              <td style="padding: 10px;"><strong>scrypt</strong></td>
              <td style="text-align: center; padding: 10px; color: #10b981;">âœ… RECOMMANDÃ‰</td>
              <td style="text-align: center; padding: 10px;">~5/s</td>
              <td style="text-align: center; padding: 10px; color: #10b981;">Excellente</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="info-box" style="margin-top: 25px;">
        <div class="info-icon">ğŸ“Š</div>
        <div class="info-content">
          <strong>Pourquoi la lenteur est importante :</strong>
          <p>
            Un attaquant peut tester 10 milliards de mots de passe par seconde avec MD5, 
            mais seulement 50 avec bcrypt. Cela rend le cracking <strong>200 millions de fois plus lent</strong> !
          </p>
        </div>
      </div>
    </div>

    <!-- Section 7 -->
    <div class="course-section">
      <h2>ğŸ“ RÃ©sumÃ© des bonnes pratiques</h2>
      <div class="checklist">
        <div class="checklist-item">
          <span class="check">âœ…</span>
          <span>N'utilisez JAMAIS MD5, SHA-1 ou SHA-256 seuls pour les mots de passe</span>
        </div>
        <div class="checklist-item">
          <span class="check">âœ…</span>
          <span>Utilisez bcrypt, Argon2 ou scrypt avec un facteur de coÃ»t adaptÃ©</span>
        </div>
        <div class="checklist-item">
          <span class="check">âœ…</span>
          <span>Ajoutez TOUJOURS un sel unique par utilisateur</span>
        </div>
        <div class="checklist-item">
          <span class="check">âœ…</span>
          <span>Envisagez l'ajout d'un pepper (sel secret global)</span>
        </div>
        <div class="checklist-item">
          <span class="check">âœ…</span>
          <span>Imposez des mots de passe robustes (12+ caractÃ¨res)</span>
        </div>
        <div class="checklist-item">
          <span class="check">âœ…</span>
          <span>VÃ©rifiez les mots de passe contre les bases de fuites</span>
        </div>
        <div class="checklist-item">
          <span class="check">âœ…</span>
          <span>Activez l'authentification Ã  deux facteurs (2FA)</span>
        </div>
        <div class="checklist-item">
          <span class="check">âœ…</span>
          <span>Mettez Ã  jour rÃ©guliÃ¨rement vos bibliothÃ¨ques de hashing</span>
        </div>
      </div>
    </div>

    <!-- CTA Challenge -->
    <div class="challenge-cta">
      <div class="cta-content">
        <h2>ğŸ¯ PrÃªt Ã  pratiquer ?</h2>
        <p>
          Maintenant que vous comprenez les rainbow tables et les failles de MD5, testez vos compÃ©tences ! 
          Vous devrez craquer 5 hash MD5 issus d'une base de donnÃ©es compromise pour obtenir le flag.
        </p>
        <div class="cta-info">
          <div class="cta-detail">
            <span class="cta-icon">â­</span>
            <span><strong>180 points</strong></span>
          </div>
          <div class="cta-detail">
            <span class="cta-icon">ğŸ“</span>
            <span>Niveau intermÃ©diaire</span>
          </div>
          <div class="cta-detail">
            <span class="cta-icon">â±ï¸</span>
            <span>10-20 minutes</span>
          </div>
        </div>
        <a href="{{ url_for('challenge_view', challenge_id=4) }}" class="btn challenge-btn-large">
          AccÃ©der au challenge Cryptographie
        </a>
      </div>
    </div>

    <!-- Navigation -->
    <div class="course-navigation">
      <a href="{{ url_for('learn_bruteforce') }}" class="nav-btn back">
        â† Cours prÃ©cÃ©dent : Bruteforce
      </a>
      <a href="{{ url_for('learn') }}" class="nav-btn next">
        Retour Ã  la bibliothÃ¨que â†’
      </a>
    </div>

  </div>

</section>
{% endblock %}